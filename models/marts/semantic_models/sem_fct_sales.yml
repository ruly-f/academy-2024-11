semantic_models:
- name: fct_sales
  description: Fact model with sales data and metrics.
  model: ref('fct_sales')
  defaults:
    agg_time_dimension: order_date
  
  entities:
  - name: order_item
    type: primary
    expr: order_item_sk
  - name: product
    type: foreign
    expr: product_fk
  - name: employee
    type: foreign
    expr: employee_fk
  - name: customer
    type: foreign
    expr: customer_fk
  - name: shipper
    type: foreign
    expr: shipper_fk
  
  dimensions:
  - name: order_date
    type: time
    type_params:
      time_granularity: day
  - name: ship_date
    type: time
    type_params:
      time_granularity: day
  - name: required_delivery_date
    type: time
    type_params:
      time_granularity: day
  - name: recipient_name
    type: categorical
  - name: recipient_city
    type: categorical
  - name: recipient_region
    type: categorical
  - name: recipient_country
    type: categorical
  - name: had_discount
    type: categorical
  
  measures:
  - name: quantity
    description: Quantity of the product ordered.
    agg: sum
    create_metric: true
  
  - name: gross_total
    description: Total amount before discount for the order item (unit price * quantity).
    agg: sum
    create_metric: true
  
  - name: net_total
    description: Total amount after discount for the order item.
    agg: sum
    create_metric: true
  
  - name: freight
    description: Freight cost allocated to the order item based on item count.
    expr: freight_allocated
    agg: sum
    create_metric: true
  
  - name: count_order_item
    agg: count
    create_metric: true
    expr: order_item_sk
  
  - name: count_product
    agg: count_distinct
    create_metric: true
    expr: product_fk
  
  - name: count_employee
    agg: count_distinct
    create_metric: true
    expr: employee_fk
  
  - name: count_customer
    agg: count_distinct
    create_metric: true
    expr: customer_fk
  
  - name: count_shipper
    agg: count_distinct
    create_metric: true
    expr: shipper_fk

metrics:
- name: gross_total_sum
  description: Total amount before discount for the order item (unit price * quantity).
  label: Gross Total
  type: simple
  type_params:
    measure:
      name: gross_total

- name: net_total_sum
  label: Net Total
  type: simple
  type_params:
    measure:
      name: net_total

- name: discount_per_order
  description: The total discount applied per order item.
  label: Discount per Order
  type: derived
  type_params:
    expr: gross_total - net_total
    metrics:
    - name: gross_total_sum
    - name: net_total_sum

    
